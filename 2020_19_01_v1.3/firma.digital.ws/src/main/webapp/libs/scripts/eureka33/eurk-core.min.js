var array=(function(){function isLiteral(argument){return(typeof(argument)==='number'||argument instanceof Number);}function validateArray(arreglo){return(typeof(arreglo)==='undefined'||arreglo===null||!(arreglo instanceof Array))?'Se espera una instancia de javascript Array no nula':null;}function validateArrayPair(arregloA,arregloB){return(arregloA.length !==arregloB.length)?'Los arreglos no tienen la misma longitud':null;}function each(arreglo,callback){let errorMessage=validateArray(arreglo);if(errorMessage===null){jQuery.each(arreglo,callback);}else{if(typeof(arreglo)!=='undefined'&&arreglo !==null){jQuery.each(arreglo,callback);}else{console.error(errorMessage);}}}function filter(list,filters,idProperty,properties){let message=validateArray(list);if(message !==null){console.error(message+": list");return null;}message=validateArray(filters);if(message !==null){console.error(message+": filters");return null;}let idField=(typeof(idProperty)==='string')?idProperty:'id';let props=(typeof(properties)==='undefined')?((idProperty instanceof Array||typeof(idProperty)==='function')?idProperty:[]):properties;let filter=null;return list.filter(function(item){filter=array.findByProperty(filters,idField,item[idField]);if(!filter){return false;}util.copyProperties(item,filter,props);return true;});}function arithmetic(operador,arregloA,arregloB){let resultado=[];let longitud=0;let expresion=null;if(isLiteral(arregloA)){let errorMessage=validateArray(arregloB);if(errorMessage===null){longitud=arregloB.length;expresion='arregloA'+operador+'arregloB[i]';for(let i=0;i <longitud;++i){resultado.push(eval(expresion));}}else{console.error(errorMessage);}}else if(isLiteral(arregloB)){let errorMessage=validateArray(arregloA);if(errorMessage===null){longitud=arregloA.length;expresion='arregloA[i]'+operador+'arregloB';for(let i=0;i <longitud;++i){resultado.push(eval(expresion));}}else{console.error(errorMessage);}}else{let errorMessage=validateArrayPair(arregloA,arregloB);if(errorMessage===null){longitud=arregloA.length;expresion='arregloA[i]'+operador+'arregloB[i]';for(let i=0;i <longitud;++i){resultado.push(eval(expresion));}}else{console.error(errorMessage);}}return resultado;}function sum(items){let total=0.0;for(let item of items){total+=item;};return total;}function accumulate(arreglo){let acumulado=[];let valor=0;each(arreglo,function(indice,item){valor=valor+item;acumulado.push(valor);});return acumulado;}function accumulateOnArray(arrA,arrB){for(let i=0;i <arrB.length;++i){arrA[i]+=arrB[i];}}function sumProperty(arreglo,propiedad){let total=0.0;each(arreglo,function(indice,item){total+=item[propiedad];});return total;}function sumColumn(matriz,indiceColumna){let total=0.0;each(matriz,function(indice,arreglo){total+=arreglo[indiceColumna];});return total;}function contains(arreglo,valor){let errorMessage=validateArray(arreglo);if(errorMessage !==null){console.error(errorMessage);return false;}let longitud=arreglo.length;for(let i=0;i <longitud;++i){if(arreglo[i]===valor){return true;}}return false;}function findByProperty(arreglo,nombrePropiedad,valor){let errorMessage=validateArray(arreglo);if(errorMessage !==null){console.error(errorMessage);return null;}let longitud=arreglo.length;let item=null;for(let i=0;i <longitud;++i){item=arreglo[i];if(item[nombrePropiedad]===valor){return item;}}return null;}function indexByProperty(arreglo,nombrePropiedad,valor){let errorMessage=validateArray(arreglo);if(errorMessage !==null){console.error(errorMessage);return-1;}let longitud=arreglo.length;let item=null;for(let i=0;i <longitud;++i){item=arreglo[i];if(item[nombrePropiedad]===valor){return i;}}return-1;}function findInsertionPoint(arreglo,nombrePropiedad,valor){let length=arreglo.length;let i;for(i=0;i <length;++i){if(valor >=arreglo[i][nombrePropiedad]){continue;}else{break;}}return i;}function equals(arregloA,arregloB){let errorMessage=validateArray(arregloA)||validateArray(arregloB);if(errorMessage !==null){console.error(errorMessage);return false;}errorMessage=validateArrayPair(arregloA,arregloB);if(errorMessage !==null){console.error(errorMessage);return false;}let longitud=arregloA.length;for(let i=0;i <longitud;++i){if(arregloA[i]!==arregloB[i]){return false;}}return true;}function compare_array(arregloA,arregloB){if(arregloA.length !==arregloB.length){return false;}if(arregloA.length===0){return true;}let itemA=arregloA[0];let itemB=null;let tipo=typeof(itemA);if(tipo==='string'||tipo==='number'||tipo==='boolean'){return array.equals(arregloA,arregloB);}let items=arregloA;let longitud=items.length;for(let i=0;i <longitud;++i){itemA=items[i];itemB=array.findByProperty(arregloB,'id',itemA.id);if(itemB===null){return false;}if(!compare(itemA,itemB)){return false;}}return true;}function compare(itemA,itemB){if(typeof(itemA)==='undefined'||typeof(itemB)==='undefined'){return false;}if((itemA==null&&itemB !=null)||(itemA !=null&&itemB==null)){return false;}if(itemA instanceof Array){return compare_array(itemA,itemB);}let tipo=typeof(itemA);if(tipo==='string'||tipo==='number'||tipo==='boolean'){return itemA===itemB;}for(prop in itemA){if(!compare(itemA[prop],itemB[prop])){return false;}}if(Object.keys(itemA).length !=Object.keys(itemB).length){return false;}return true;}function first(arreglo){return arreglo[0];}function last(arreglo,backIndex=0){return arreglo[arreglo.length-1+backIndex];}function toInt(arreglo){return arreglo.map(item=>{let tipo=typeof(item);if(tipo==='undefined'||item===null||(tipo==='string'&&item.length===0)){return null;}else{return util.parseInt(item);}});}return{each:each,contains:contains,findByProperty:findByProperty,indexByProperty:indexByProperty,findInsertionPoint:findInsertionPoint,compare:compare,equals:equals,filter:filter,sum:sum,sumProperty:sumProperty,sumColumn:sumColumn,accumulate:accumulate,accumulateOnArray:accumulateOnArray,add:function(a,b){return arithmetic('+',a,b);},substract:function(a,b){return arithmetic('-',a,b);},divide:function(a,b){return arithmetic('/',a,b);},multiply:function(a,b){return arithmetic('*',a,b);},first:first,last:last,toInt:toInt};})();var util={generarID:function(){let s=Math.random().toString();return s.substring(s.length-12);},obtenerIconoExtension:function(nombreArchivo){let extension=nombreArchivo.slice((nombreArchivo.lastIndexOf(".")-1 >>>0)+2);if(array.contains(["doc","docx","jpg","pdf","png","txt","xls","xlsx","xml"],extension)){return extension;}else{return "documento";}},setFechaHoraActual:function(item){var fechaHora=new Date();item.fecha=getFechaDDMDAAAA(fechaHora);item.hora=padWithLeftZeros(fechaHora.getHours(),2)+":"+padWithLeftZeros(fechaHora.getMinutes(),2);},getFechaDDMDAAAA:function(instanciaDate){return padWithLeftZeros(instanciaDate.getDate(),2)+"/"+padWithLeftZeros((instanciaDate.getMonth()+1),2)+"/"+padWithLeftZeros(instanciaDate.getFullYear(),2);},getMesAnteriorMMAAAA:function(instanciaDate){var mesActual=instanciaDate.getMonth();var year=instanciaDate.getFullYear();var mesAnterior=mesActual;if(mesAnterior===0){mesAnterior=12;year=year-1;}return padWithLeftZeros(mesAnterior,2)+"/"+padWithLeftZeros(year,2);},padWithLeftZeros:function(valor,length){var cadena=""+valor;while(cadena.length <length){cadena="0"+cadena;}return cadena;},getQueryParam:function(parametro){var param=parametro;location.search.substr(1).split("&").some(function(item){return item.split("=")[0]===param&&(param=item.split("=")[1]);});return(param===parametro)?"":param;},compararFecha:function(referenceDate,fechaDDMMYYYY){let timeA=obtenerFecha(getFechaDDMDAAAA(referenceDate)).getTime();let timeB=obtenerFecha(fechaDDMMYYYY).getTime();return truncar((timeB-timeA)/86400000);},obtenerFecha:function(fechaDDMMYYYY){var tokens=fechaDDMMYYYY.split("/");var dia=parseInt(tokens[0],10);var mes=parseInt(tokens[1],10);var year=parseInt(tokens[2],10);return new Date(year,mes-1,dia,23,59,59,999);},parametros:function(){let hash=window.location.hash;if(!hash||hash.length <=2){return{};}let sinHash=hash.split('#/');if(!sinHash||sinHash.length <2){return{};}let items=hash.split('#/')[1].split('&');let params={};for(let item of items){valores=item.split('=');params[valores[0]]=valores[1];}return params;},getTokens:function(line){let tokens=line.split(/(\s+)/).filter(function(e){return e.trim().length >0;});return Array.from(new Set(tokens));},copyProperties:function(target,source,props){if(props instanceof Array){array.each(props,function(indice,prop){target[prop]=source[prop];});}else{props(target,source);}},getItemRecursive:function(items,path,property='id'){let item=null;for(let id of path){item=array.findByProperty(items,property,id);items=item.data;}return item;},pathToArray:function(items,path,property='id'){let values=[];let item=null;for(let id of path){item=array.findByProperty(items,property,id);values.push(item);items=item.data;}return values;},parseInt(s){let v=parseInt(s,10);if(isNaN(v)){throw new TypeError('"'+s+'" cannot be parsed as integer');}else{return v;}},getPath(s,sp='_'){return s.split(sp).slice(1).map(v=>{return util.parseInt(v);});}};var callbacks={onClickAction:function(event){let control=jQuery(event.target);let action=control.data('value');let module=control.data('module');switch(action){case 'add':env[module].operation='add';env[module].idItem="0";modMngr.execAction(((module)?action+'_'+module:action));break;case 'save':componente[module].saveItem(module);break;default:modMngr.execAction(((module)?action+'_'+module:action));}}};var popup=(function(){let isOpen=false;function init_processing_message(title,message,progreso){modalWindow.mostrarMensajeProgreso(title||'Registro de Información',message||'1. Enviando información al servidor');modalWindow.actualizaProgreso(progreso||0.5);isOpen=true;}function update_processing_message(message,progreso){if(isOpen){modalWindow.actualizaProgreso(progreso);modalWindow.actualizarPaso(message);}}function end_processing_message(message){if(isOpen){modalWindow.actualizaProgreso(1.0);modalWindow.actualizarPaso(message||'2. Información Registrada con éxito');setTimeout(modalWindow.dismiss,1000);isOpen=false;}}function force_dismiss(){modalWindow.dismissisOpen=false;}return{init_processing_message:init_processing_message,update_processing_message:update_processing_message,end_processing_message:end_processing_message,force_dismiss:force_dismiss};})();function muestraModal(mensaje,loader){jQuery(".modal-title").text("");dom.getById('mensajeModal').text(mensaje);dom.getById('btnModal').hide();let jloader=dom.getById('loader').attr('src','_recursos_/imagenes/loader.gif');if(loader){jLoader.show();}else{jLoader.hide();}dom.getById('modal').modal();}function ocultarModal(identificador){dom.getById(identificador).hide();}function errorModal(titulo,error){jQuery(".modal-title").text(titulo);dom.getById('mensajeModal').text(error);dom.getById('loader').hide();dom.getById('btnModal').show();}var _log_={isDebugActivo:true,info:function(texto){var control=dom.getById('logActividad');control.val(control.val()+texto+"\n");},error:function(error){_log_.info("[ERROR]: "+error);},debug:function(texto){if(isDebugActivo){_log_.info("[DEBUG]: "+texto);}}};var format=(function(){let numberRegExp=new RegExp('^[+|-]?[0-9]*\\.?[0-9]*$','g');function findMatch(texto){let match=numberRegExp.exec(texto);numberRegExp.lastIndex=0;return match;}function obtenerNumero(cantidad){let tipo=typeof(cantidad);if(tipo==='number'&&!isNaN(cantidad)){return cantidad;}if(tipo==='undefined'||cantidad==null){console.error('La cantidad indicada no esta definida o es nula');return null;}if(tipo==='string'||typeof(cantidad.toString)==='function'){let valor=cantidad.toString();let match=findMatch(valor);if((match==null)||(match.length !=1)||(match[0].length !=valor.length)){console.error('La cantidad indicada no tiene el formato de un número: '+valor);return null;}return parseFloat(cantidad);}else{console.error('Cadena de texto no parseable a número: '+cantidad);return null;}}function truncar(numero){return(numero >=0.0)?Math.floor(numero):Math.ceil(numero);}function formatNumero(cantidad){let numero=obtenerNumero(cantidad);if(numero==null){return 'error';}return numero.toFixed(2).replace(/./g,function(match,indice,original){if(indice >1){return(match !=="."&&((original.length-indice)%3===0))?','+match:match;}else if(indice==1){return((original.charAt(0)!=='-')&&match !=="."&&((original.length-indice)%3===0))?','+match:match;}else{return match;}});}function formatMonto(monto){let strNumero=formatNumero(monto);return(strNumero.charAt(0)==='-')?strNumero.replace('-','-$'):'$'.concat(strNumero);}function formatEntero(numero){let cadena=formatNumero(numero);return cadena.substring(0,cadena.length-3);}function formatPorcentaje(porcentaje){return formatNumero(porcentaje)+'%';}function plainNumber(cadena){if(typeof(cadena)==='string'){return cadena.replace(/,/g,'').replace(/\$/g,'').replace(/\%/g,'').trim();}else{return ""+cadena;}}return{number:formatNumero,integer:formatEntero,currency:formatMonto,percentage:formatPorcentaje,plainNumber:plainNumber};})();var modalWindow={barraProgreso:null,actualizaProgreso:function(progreso){let porcentaje=progreso*100.0+'%';this.barraProgreso[0].style.width=porcentaje;this.barraProgreso[0].textContent=porcentaje;if(progreso==1.0){dom.getById('divAvanceResultado').html('<div class="alert alert-success" role="alert">Información registrada con éxito.</div>');}},actualizarPaso:function(textoPaso){dom.getById("divTextoPaso").text(textoPaso);},mostrarSaveDialog:function(){var footer='<button class="btn btn-primary disabled" onclick="guardarItem(event ,'+"'"+id+"'"+');">'+'<i class="fa fa-save" style="padding-right: 0.5em;"></i>Guardar'+'</button>'+'<button class="btn btn-danger" style="margin-left: 5px;" data-dismiss="modal">'+'<i class="fa fa-times" style="padding-right: 0.5em;"></i>Cancelar'+'</button>';jQuery(".modal-title").append('<h5 class>Nuevo Registro de Presupuesto</h5>');jQuery(".icon-modal").show();jQuery(".icon-modal").append('<img class="img-fluid align-middle" src="_recursos_/imagenes/iconos/file.png">');jQuery(".modal-footer").append('<section class="footer-modal">'+footer+'</section>');dom.getById('work-modal').modal({backdrop:false,keyboard:true});},mostrarYesNoDialog:function(titulo,mensaje,callback){this.callback=callback;this.modalMessage({title:titulo,icon:this.icons["alerta"],message:'<section style="margin-bottom: 10px">'+mensaje+"</section>",footer:'<button class="btn btn-primary disabled" data-dismiss="modal" onclick="modalWindow.invokeCallback();">'+'<i class="fa fa-check" style="padding-right: 0.5em;"></i>Aceptar'+'</button>'+'<button class="btn btn-danger" style="margin-left: 5px;" data-dismiss="modal">'+'<i class="fa fa-times" style="padding-right: 0.5em;"></i>Cancelar'+'</button>'});},mostrarFormDialog:function(titulo,formHTML,callback,maintainOpen){this.callback=callback;this.modalMessage({title:titulo,icon:this.icons["requisito"],message:'<section style="margin-bottom: 10px">'+formHTML+"</section>",footer:'<button class="btn btn-primary disabled" '+(maintainOpen?'':'data-dismiss="modal" ')+'onclick="modalWindow.invokeCallback();">'+'<i class="fa fa-check" style="padding-right: 0.5em;"></i>Aceptar'+'</button>'+'<button class="btn btn-danger" style="margin-left: 5px;" data-dismiss="modal">'+'<i class="fa fa-times" style="padding-right: 0.5em;"></i>Cancelar'+'</button>'});},mostrarMensajeProgreso:function(titulo,mensaje){this.modalMessage({title:titulo,icon:this.icons["fases"],message:'<section id="divTextoPaso" style="margin-bottom: 10px">'+mensaje+'</section>',footer:'<div id="divAvanceResultado" class="container-fluid"><div class="barra_progreso"><div class="percent">0%</div></div></div>',closeable:false});jQuery(".barra_progreso").addClass("loading");this.barraProgreso=jQuery(".percent");},invokeCallback:function(){this.callback();},mostrarErrorInvocacion:function(codigoErrorHTML,recurso){var info={title:"",icon:"",message:"",footer:""};var errorHTML=this.htmlErrorCodes[codigoErrorHTML];if(errorHTML){info.title=errorHTML.titulo;info.icon=this.icons["alerta"];info.message="<section style='margin-bottom: 10px'> Recurso : "+recurso+"</section>"+errorHTML.descripcion;}else{info.title="Código de Error no registrado: '"+codigoErrorHTML+"'";info.icon=this.icons["alerta"];info.message="Error HTML desconocido, favor de contactar al administrador."}this.modalMessage(info);},mostrarErroresRespuesta:function(respuesta){let info={title:this.tipos_errores[respuesta.clave],icon:this.icons["alerta"],message:respuesta.mensajes[0].mensaje};this.modalMessage(info);},mostrarErrorRespuesta:function(mensaje){var info={title:"Error de Negocio",icon:this.icons["alerta"],message:mensaje};this.modalMessage(info);},modalMessage:function(object){let ventana=dom.getById('message-modal');ventana.find(".modal-title").html(object.title);if(object.icon){ventana.find(".icon-modal").html('<img class="img-fluid align-middle" src="_recursos_/imagenes/iconos/'+object.icon+'.png">').show();}else{ventana.find(".icon-modal").hide();ventana.find(".body-modal").removeClass("col-sm-9").addClass("col-sm-12");}ventana.find(".body-modal").html(object.message);if(object.footer){ventana.find(".modal-footer").html(object.footer).show();}else{ventana.find(".modal-footer").hide();}if(typeof(object.closeable)=="undefined"||object.closeable){ventana.find(".close").show();}else{ventana.find(".close").hide();}ventana.modal('show');},dismiss:function(){dom.getById('message-modal').modal('hide');},tipos_errores:{"operacion.exitosa":"Operación Exitosa","error.negocio":"Error de Negocio","error.peticion":"Peticion Erronea","error.infraestructura":"Error de Infrestructura","error.desconocido":"Error Desconocida"},icons:{"alerta":"warning","passInvalid":"shield","package":"package","file":"file","phase":"calendar","requisito":"skill","fases":"checklist","otro":"blank","csv":"csv","doc":"doc","docx":"doc","jpg":"jpg","pdf":"pdf","png":"png","ppt":"ppt","pptx":"ppt","rtf":"rtf","txt":"txt","xls":"xls","xlsx":"xls","zip":"zip"},htmlErrorCodes:{"400":{titulo:"Error 400 - Solicitud Incorrecta.",descripcion:"El servidor no es capaz de entender la petición del navegador porque su sintaxis no es correcta."},"401":{titulo:"Error 401 - No autorizado.",descripcion:"El recurso solicitado por el navegador requiere de autenticaci&oacute;n. La respuesta incluye una cabecera de tipo WWW-Authenticate para que el navegador pueda iniciar el proceso de autenticaci&ocute;n."},"402":{titulo:"Error 402 - Pago Requerido.",descripcion:"Este código está reservado para usos futuros."},"403":{titulo:"Error 403 - Prohibido",descripcion:"La petición del navegador es correcta, pero el servidor no puede responder con el recurso solicitado porque se ha denegado el acceso."},"404":{titulo:"Error 404 - No encontrado.",descripcion:"El servidor no puede encontrar el recurso solicitado por el navegador y no es posible determinar si esta ausencia es temporal o permanente."},"405":{titulo:"Error 405 - Metodo no permitido.",descripcion:"El navegador ha utilizado un método (GET, POST, etc.) no permitido por el servidor para obtener ese recurso."},"406":{titulo:"Error 406 - Inaceptable.",descripcion:"El recurso solicitado tiene un formato que en teoría no es aceptable por el navegador, según los valores que ha indicado en la cabecera Accept de la petición."},"407":{titulo:"Error 407 - Se requiere autenticación proxy.",descripcion:"La solicitud no se ha realizado porque carece de credenciales validas para un servidor proxy."},"408":{titulo:"Error 408 - Tiempo de espera superado.",descripcion:"La solicitud no se llevo a cabo dentro del tiempo de espera establecido por el servidor."},"409":{titulo:"Error 409 - Conflicto.",descripcion:"La solicitud no pudo ser procesada debido a un conflicto con el recurso actual."},"410":{titulo:"Error 410 - Removido.",descripcion:"El recurso solicitado ha sido removido permanentemente."},"411":{titulo:"Error 411 - Longitud Requerida.",descripcion:"El servidor rechazo la petición del navegador porque no incluye la cabecera 'Content-Length' adecuada."},"412":{titulo:"Error 412 - Condición previa falló.",descripcion:"El servidor no es capaz de cumplir con algunas de las condiciones impuestas por el navegador en su petición."},"413":{titulo:"Error 413 - Solicitud muy grande.",descripcion:"La petición al servidor es demasiado grande y no puede ser procesada."},"414":{titulo:"Error 414 - Solicitud muy grande.",descripcion:"La petición al servidor es demasiado grande y no puede ser procesada."}}};var modMngr=(function(){let contenedores={};function cargar_submodulo(nombre,menuItem){let nombreModulo=menuItem.modulo;let nombreSubmodulo=menuItem.submodulo;let params=menuItem.params||{};let contenedor=contenedores[nombre];if(!contenedor){contenedor={};contenedores[nombre]=contenedor;}let modulo=contenedor.modulo;if(!modulo||modulo.nombre !==nombreModulo){load_and_init_modulo(contenedor,nombre,nombreModulo,nombreSubmodulo,params);}else{init_submodulo(contenedor,nombre,modulo,nombreModulo,nombreSubmodulo,params);}}function request_action(action){if(action==='[update]'){let modulo=contenedores['workArea'].modulo;modulo.callbacks.update(modulo.params);mostrar_vista('workArea','init');}else{mostrar_vista('workArea',action);}}function load_and_init_modulo(contenedor,nombre,nombreModulo,nombreSubmodulo,params){let modulo={nombre:nombreModulo,submodulo:null,vista:null,callbaks:null,params:params};contenedor.modulo=modulo;let recurso='modulos/'+nombreModulo+'/index';server.resource.load('modules',recurso,function(){initModulo();load_and_init_submodulo(nombre,modulo,nombreSubmodulo,params);});}function init_submodulo(contenedor,nombre,modulo,nombreModulo,nombreSubmodulo,params){modulo.params=params;if(modulo.submodulo===nombreSubmodulo){modulo.callbacks.update(params);mostrar_vista(nombre,'init');}else{load_and_init_submodulo(nombre,modulo,nombreSubmodulo,params);}}function load_and_init_submodulo(contenedor,modulo,submodulo,params){let recurso="modulos/"+modulo.nombre+"/views/"+submodulo;server.resource.load(contenedor,recurso,function(){modulo.vista=null;modulo.submodulo=submodulo;modulo.callbacks=moduleCallbacks();modulo.callbacks.getVistaActual=function(){return modulo.vista;};contenedores[contenedor].modulo.callbacks.init(params);mostrar_vista(contenedor,'init');});}function mostrar_vista(contenedor,accion){let modulo=contenedores[contenedor].modulo;let vistaActual=modulo.vista;let siguienteVista=modulo.callbacks.getSiguienteVista(accion);if(!siguienteVista){console.error('Vista no definida para la acción: '+accion);return;}if(vistaActual !=siguienteVista){activar_vista(contenedor,siguienteVista);if(!modulo.callbacks[siguienteVista]){console.error('Callback no definido: '+siguienteVista+'() {modulo: '+modulo.nombre+', submodulo: '+modulo.submodulo+'}');return;}modulo.callbacks[siguienteVista]();modulo.vista=siguienteVista;}}function activar_vista(contenedor,nombreVista){jQuery("#"+contenedor+" .vista").each(function(index,element){element.hidden=(element.id !=nombreVista);});}return{load:cargar_submodulo,execAction:request_action};})();var templates=(function(){var items={};function getTemplate(idTemplate){let template=items[idTemplate];if(template){return template;}let source=dom.getById(idTemplate);if(source===null){return null;}template=Handlebars.compile(source.html());if(idTemplate.indexOf('Partial')>0){Handlebars.registerPartial(idTemplate,source.html());}items[idTemplate]=template;return template;}return{fillTemplate:function(idTemplate,contexto){let template=getTemplate(idTemplate);if(template){return template(contexto);}console.error('Template no encontrado: ['+idTemplate+']');return null;},registerPartial:function(idTemplate){let template=getTemplate(idTemplate);if(!template){console.error('Template no encontrado: ['+idTemplate+']');}}};})();Handlebars.registerHelper('formatCurrency',function(monto){if(typeof(monto)==='undefined'||monto===null){return new Handlebars.SafeString('<span></span>');}let texto=format.currency(monto);if(monto <0.0){texto='<span class="negativo">'+texto+'</span>';}else{texto='<span class="positivo">'+texto+'</span>';}return new Handlebars.SafeString(texto);});Handlebars.registerHelper('formatPropertyCurrency',function(bean,campo){let monto=bean[campo];if(typeof(monto)==='undefined'||monto===null){return new Handlebars.SafeString('<span></span>');}let texto=format.currency(monto);if(monto <0.0){texto='<span class="negativo">'+texto+'</span>';}else{texto='<span class="positivo">'+texto+'</span>';}return new Handlebars.SafeString(texto);});Handlebars.registerHelper('formatPercentage',function(valor){let texto=format.percentage(valor);if(valor <0.0){texto='<span class="negativo">'+texto+'</span>';}else{texto='<span class="positivo">'+texto+'</span>';}return new Handlebars.SafeString(texto);});Handlebars.registerHelper('formatMatches',function(tokens,texto){if(typeof(tokens)==='undefined'||tokens===null||tokens.length===0){return texto;}tokens=Array.from(new Set(tokens));let longitud=tokens.length;let token=null;for(let t=0;t <longitud;++t){token=tokens[t];var matches=texto.match(new RegExp(token,"gi"));if(matches&&matches.length >0){var reemplazos=Array.from(new Set(matches));var reemplazo=null;for(let i=0;i <reemplazos.length;++i){reemplazo=reemplazos[i];texto=texto.replace(new RegExp(reemplazo,"g"),'<b>'+reemplazo+'</b>');}}}return new Handlebars.SafeString(texto);});Handlebars.registerHelper('property',function(bean,campo,propiedad){if(typeof(propiedad)==='string'){return new Handlebars.SafeString(bean[campo][propiedad]||'');}else{return new Handlebars.SafeString(bean[campo]||'');}});Handlebars.registerHelper('times',function(n,block){let resultado='';for(let i=0;i <n;++i){resultado+=block.fn(i);}return resultado;});Handlebars.registerHelper('list',function(items,options){let resultado='';for(let i=0;i <items.length;++i){resultado+=options.fn(items[i]);}return resultado;});Handlebars.registerHelper('if_eq',function(a,b,opts){b=(typeof(a)==='number'&&typeof(b)==='string')?util.parseInt(b):b;return(a===b)?opts.fn(this):opts.inverse(this);});Handlebars.registerHelper('if_eq_prop',function(bean,campo,valor,opts){return(bean[campo]===valor)?opts.fn(this):opts.inverse(this);});Handlebars.registerHelper('if_gt_prop',function(bean,campo,valor,opts){return(bean[campo]>valor)?opts.fn(this):opts.inverse(this);});Handlebars.registerHelper('if_isPerfil',function(p,opts){let estatus=versionPrsp.value().estatus;let mostrar=(estatus==='CAPTURA_ABIERTA'||(estatus==='CAPTURA_CERRADA'&&perfilPrsp.value()==='ADMIN_PRESUPSTO'));return(mostrar)?opts.fn(this):opts.inverse(this);});var ui={form:function(nombre,modelo){var contenedor=nombre+"Form";if(modelo.layout){layout.form(contenedor,modelo);}else{console.log("Formulario sin información de layout.");}for(var propiedad in modelo.fields){var metadatos=modelo.fields[propiedad];if(metadatos.bind){ui.bind(contenedor,modelo,propiedad,metadatos);}if(metadatos.catalog||metadatos.options){ui.setOptionsInit(contenedor,modelo,propiedad,metadatos);}}jQuery("#"+contenedor+" .ui-control").off('change.ui-control focus.ui-control blur.ui-control').on('change.ui-control',this._generarOnChange_Callback(modelo)).on('focus.ui-control',this._generarOnFocus_Callback(modelo)).on('blur.ui-control',this._generarOnBlur_Callback(modelo));this.update(contenedor,modelo);},update:function(contenedor,modelo){var model=modelo;jQuery("#"+contenedor+" .ui-control").each(function(indice,control){ui.updateControl(control,model);});},updateControl:function(control,modelo){var item=model.get(modelo.valores,control.name);if(!item){return;}if(control.type==="text"||control.type==="password"){control.value=item.label;}else if(control.type==="checkbox"){control.checked=(item&&(item===control.value));}else{control.value=item.value;}jQuery(control).change();},_generarOnFocus_Callback:function(modelo){var values=modelo.valores;var callbacks=modelo.callbacks;return function(event){var control=event.target;if(control.type==="text"){if(jQuery(control).hasClass("number")){control.value=format.plainNumber(this.value);}}};},_generarOnBlur_Callback:function(_modelo){var modelo=_modelo;var values=_modelo.valores;var callbacks=_modelo.callbacks;return function(event){var control=event.target;if(control.type==="text"){if(jQuery(control).hasClass("currency")){let valor=format.currency(format.plainNumber(this.value));control.value=(valor=="$NaN")?"$0.00":valor;var bean=model.get(values,control.name);if(typeof(bean)==="undefined"||valor=="$NaN"){model.update(modelo.valores,control.name,{value:0.00,label:"$0.00"});jQuery(control).change();}}else if(jQuery(control).hasClass("percentage")){let valor=format.percentage(format.plainNumber(this.value));control.value=(valor=="NaN %")?"0.00 %":valor;var bean=model.get(values,control.name);if(typeof(bean)==="undefined"||valor=="NaN %"){model.update(modelo.valores,control.name,{value:0.00,label:"0.00 %"});jQuery(control).change();}}else if(jQuery(control).hasClass("number")){let valor=format.number(format.plainNumber(this.value));control.value=(valor=="NaN")?"0.00":valor;var bean=model.get(values,control.name);if(typeof(bean)==="undefined"||valor=="NaN"){model.update(modelo.valores,control.name,{value:0.00,label:"0.00"});jQuery(control).change();}}}};},_generarOnChange_Callback:function(modelo){var values=modelo.valores;var callbacks=modelo.callbacks;return function(event){var control=event.target;if(control.type==="text"||control.type==="password"||control.type==='textarea'){if(jQuery(control).hasClass("number")){var value=parseFloat(format.plainNumber(this.value));model.update(values,this.name+".value",value);}else{model.update(values,this.name+".value",this.value);}}else if(control.type==="checkbox"){let bean=model.get(values,this.name);if(bean.sticky){control.checked=bean.value;bean.sticky=false;}else{model.update(values,this.name+".value",control.checked);}}else{let bean=model.get(values,this.name);if(typeof(bean)==='undefined'){bean={value:null};values[this.name]=bean;}if(control[control.selectedIndex]){let valorActual=this.value;let last=(typeof(bean.last)==='undefined')?null:bean.last;let sticky=(typeof(bean.sticky)==='undefined')?null:bean.sticky;bean={value:this.value,label:control[control.selectedIndex].label,last:last,sticky:sticky};model.update(values,this.name,bean);if(valorActual !=last){bean.last=valorActual;}else{return;}}else{let valorActual=bean.value;let last=(typeof(bean.last)==='undefined')?null:bean.last;if(valorActual !=last){let items=control.options;let item=null;for(let i=0;i <items.length;i++){item=items[i];if(item.value===valorActual){control.selectedIndex=i;}}bean.last=valorActual;}else{return;}}}if(callbacks&&callbacks["onChange_"+control.name]){callbacks["onChange_"+control.name](values);}};},setOptions:function(contenedor,modelo,propiedad,metadatos,propiedades){var consulta={tipo:"NOPAGINADA"};if(propiedades){consulta.propiedades=propiedades;}else{consulta.propiedades={};}consulta.ordenacion=[{campo:'label',direccion:'asc'}];let config=modelo.valores.formData;if(config&&config.showCode){consulta.ordenacion=[{campo:'code',direccion:'asc'}];}server.data.listCatalog(metadatos.catalog,consulta,ui._generarAddOptions(contenedor,modelo,propiedad));},setOptionsInit:function(contenedor,modelo,propiedad,metadatos){let consulta={tipo:"NOPAGINADA",propiedades:{}};if(metadatos.catalog){if(metadatos.init){let actualizar=true;let campos=metadatos.init;for(let i=0;i <campos.length;++i){let valor=null;if(campos[i].value){valor=campos[i].value;}else{let bean=model.get(modelo.valores,campos[i].field);if(!bean){console.error('Dependency <'+campos[i].field+'> not found: {contenedor: '+contenedor+', propiedad: '+propiedad+'}');return;}else{valor=bean.value;}}if(typeof(valor)==='undefined'||valor===null||valor.length===0){actualizar=false;}if(campos[i].targetType==='int'){consulta.propiedades[campos[i].queryProperty]=parseInt(valor,10);}else{consulta.propiedades[campos[i].queryProperty]=valor;}}if(actualizar){consulta.ordenacion=[{campo:'label',direccion:'asc'}];let config=modelo.valores.formData;if(config&&config.showCode){consulta.ordenacion=[{campo:'code',direccion:'asc'}];}server.data.listCatalog(metadatos.catalog,consulta,ui._generarAddOptions(contenedor,modelo,propiedad));}}else if(typeof(metadatos.init)==='undefined'&&typeof(metadatos.bind)==='undefined'){consulta.ordenacion=[{campo:'label',direccion:'asc'}];let config=modelo.valores.formData;if(config&&config.showCode){consulta.ordenacion=[{campo:'code',direccion:'asc'}];}server.data.listCatalog(metadatos.catalog,consulta,ui._generarAddOptions(contenedor,modelo,propiedad));}}if(metadatos.options){let items=metadatos.options;if(!items){return;}let longitud=items.length;let item=null;var select=jQuery("#"+contenedor+" [name='"+propiedad+"']");if(select.length===0){console.error('DOM element does not exist: {contenedor: '+contenedor+', propiedad: '+propiedad+'}');return;}else{for(var i=0;i <longitud;++i){item=items[i];select.append(jQuery("<option/>",{value:item.value,html:item.label}));}if(longitud===1){model.update(modelo.valores,propiedad,{value:items[0].value,label:items[0].label});}ui.updateControl(select[0],modelo);}}},actualizarCampo:function(contenedor,modelo,propiedad,metadatos,nuevoValor){let control=jQuery("#"+contenedor+" [name='"+propiedad+"']");let valor=nuevoValor;if(control[0]){if(control[0].type==="text"){if(control.hasClass("currency")){valor=format.currency(nuevoValor);}else if(control.hasClass("percentage")){valor=format.percentage(nuevoValor);}else if(control.hasClass("number")){valor=format.number(nuevoValor);}}model.update(modelo.valores,propiedad,{value:nuevoValor,label:valor});ui.updateControl(control[0],modelo);}},bind:function(idContenedor,modelo,propiedad,metadatos){jQuery.each(metadatos.bind,function(indice,bindItem){if(bindItem.type !=='const'){var item=jQuery("#"+idContenedor+" [name='"+bindItem.field+"']");item.on("change",ui._generarChangeCallback(idContenedor,modelo,propiedad,metadatos));}});},_empty:function(idContenedor,nombreCampo){jQuery('#'+idContenedor+" [name='"+nombreCampo+"']"+' option').each(function(indice,item){if(item.value !=''){jQuery(item).remove();}});jQuery('#'+idContenedor+" [name='"+nombreCampo+"']"+' optgroup').remove();},_generarAddOptions:function(_contenedor,_modelo,_nombreCampo){var id=_contenedor;var modelo=_modelo;var nombre=_nombreCampo;return function(data){let items=data.items;if(!items){return;}let longitud=items.length;let select=jQuery("#"+id+" [name='"+nombre+"']");for(let item of items){if(item.items){let grupo=jQuery('<optgroup/>',{label:item.label});item.items.forEach(child=>{grupo.append(jQuery("<option/>",{value:child.value,html:child.label}));});select.append(grupo);}else{if(modelo.templates&&modelo.templates.option){select.append(templates.fillTemplate(modelo.templates.option,{item:item,config:modelo.valores.formData}));}else{select.append(jQuery("<option/>",{value:item.value,html:item.label}));}}}if(longitud===1){model.update(modelo.valores,nombre,{value:items[0].value,label:items[0].label});}ui.updateControl(select[0],modelo);};},_generarChangeCallback:function(idContenedor,_modelo,campoDependiente,metadatos){let bean={id:idContenedor,modelo:_modelo,campo:campoDependiente,metadatos:metadatos,propiedad:metadatos.bind};return function(event){let value=jQuery(event.target).val();ui._empty(bean.id,bean.campo);let campoIndependiente=event.target.name;let propiedades={};let actualizar=true;for(let bindItem of bean.propiedad){let valor=null;if(bindItem.field !==campoIndependiente){valor=model.get(bean.modelo.valores,bindItem.field);valor=valor?valor.value:null;}else{valor=value;}if(typeof(valor)==="undefined"||valor===null||valor.length===0){actualizar=false;break;}if(bindItem.targetType==="int"){valor=parseInt(valor,10);}else if(bindItem.targetType==="number"){valor=parseFloat(format.plainNumber(valor));}propiedades[bindItem.queryProperty]=valor;}if(actualizar){if(bean.metadatos.catalog){ui.setOptions(bean.id,bean.modelo,bean.campo,bean.metadatos,propiedades);}else{var callbacks=bean.modelo.callbacks;if(callbacks&&callbacks["onUpdate_"+bean.campo]){var nuevoValor=callbacks["onUpdate_"+bean.campo](propiedades);ui.actualizarCampo(bean.id,bean.modelo,bean.campo,bean.metadatos,nuevoValor);}}}};},mostrarMensajeSinSesion:function(){jQuery(".ui.modal.session").modal({closable:false});},mostrarMensajeSinCiclo:function(){dom.create("workArea",'_workArea_sin_ciclo_',{});},mostrarMensajeSinVersion:function(){dom.create("workArea",'_workArea_sin_version_',{});}};ui.toggleDiv={init:function(){dom.onClick('.toggle-div',ui.toggleDiv.on_click_toggle_callback);},initSimple:function(){dom.onClick('.toggle-div',ui.toggleDiv.on_click_toggle_simple_callback);},openAll:function(){let button,target;jQuery('button.toggle-div').each(function(idx,item){button=jQuery(item);target=dom.getById(button.data('target'));target.attr('hidden',false).data('toggle','1');button.children().removeClass('fa-angle-double-down').addClass('fa-angle-double-up');});},open:function(id){ui.toggleDiv.reset_toggle();let jItem=dom.getById(id+"_toggle-div");dom.getById(jItem.data('target')).attr('hidden',false).data('toggle','1');jItem.children().removeClass('fa-angle-double-down').addClass('fa-angle-double-up');},on_click_toggle_callback:function(event){let button=ui.toggleDiv.find_button(jQuery(event.currentTarget));let target=dom.getById(button.data('target'));let toggle=util.parseInt(target.data('toggle'));ui.toggleDiv.reset_toggle();if(toggle===0){target.attr('hidden',false).data('toggle','1');button.children().removeClass('fa-angle-double-down').addClass('fa-angle-double-up');}},on_click_toggle_simple_callback:function(event){let button=ui.toggleDiv.find_button(jQuery(event.currentTarget));let target=dom.getById(button.data('target'));let toggle=util.parseInt(target.data('toggle'));if(toggle===0){target.attr('hidden',false).data('toggle','1');button.children().removeClass('fa-angle-double-down').addClass('fa-angle-double-up');}else{target.attr('hidden',true).data('toggle','0');button.children().removeClass('fa-angle-double-up').addClass('fa-angle-double-down');}},reset_toggle:function(){let button,target;jQuery('button.toggle-div').each(function(idx,item){button=jQuery(item);target=dom.getById(button.data('target'));target.attr('hidden',true).data('toggle','0');button.children().removeClass('fa-angle-double-up').addClass('fa-angle-double-down');});},find_button:function(jItem){if(jItem.is('button')){return jItem;}return jItem.parents('div.card-header:eq(0)').find('button.toggle-div:eq(0)');}};var layout={form:function(id,metadata){let html=templates.fillTemplate("formLayout",{id:id});dom.getById(id+'Contenedor').empty().append(html);let contenedor=dom.getById('content'+id);let longitud=metadata.layout.length;for(var i=0;i <longitud;++i){layout._createRowContainer(contenedor,id,i,metadata.layout[i].hidden);layout._addRowFields(id,i,metadata.layout[i],metadata.fields);}},_createRowContainer:function(contenedor,id,row,hidden){let html=templates.fillTemplate("rowLayout",{id:id,row:row,hidden:hidden});contenedor.append(html);},_addRowFields:function(id,row,rowMetadata,fieldsMetadata){let items=rowMetadata.fields;let longitud=items.length;let size=rowMetadata.size;if(!size){size=parseInt(12/longitud,10);if(size <2){size=2;}}let contenedor=dom.getById(id+'_content_row'+row);let html=null;let item=null;for(let i=0;i <longitud;++i){item=items[i];item.label=null;if(item.type==="title"){item.label=item.value;}else{item.label=fieldsMetadata[item.name].prompt;}if(!item.size){item.size=size;}if(!item.readOnly){item.readOnly=false;}html=templates.fillTemplate("formField",item);contenedor.append(html);}}};var model={get:function(referenciaBase,pathVariable){let referencia=referenciaBase;let items=pathVariable.split(".");let longitud=items.length;let item,next=null;for(let i=0;i <longitud;++i){item=items[i];if(!referencia){return undefined;}let tokens=item.split(/\[|\]/);if(tokens.length===1){next=referencia[item];}else{next=referencia[tokens[0]][tokens[1]];}if(!next&&i <(longitud-1)){next={};referencia[item]=next;}referencia=next;}if(!referencia){return undefined;}return referencia;},update:function(referenciaBase,pathVariable,valor){let referencia=referenciaBase;let items=pathVariable.split(".");let longitud=items.length-1;let item,next=null;for(let i=0;i <longitud;++i){item=items[i];if(!referencia){console.error("Error al establecer propiedad: "+pathVariable+"(alguna referencia no existe dentro del trayecto)");return;}next=referencia[item];if(!next&&i <longitud){next={};referencia[item]=next;}referencia=next;}item=items[longitud];referencia[item]=valor;},getBean:function(modelo){let campos=modelo.fields;let bean={};let valor,target,type,exclude=null;for(let propiedad in campos){target=campos[propiedad].target||propiedad;type=campos[propiedad].targetType;exclude=campos[propiedad].exclude;if(target&&(exclude !=true)){valor=model.get(modelo.valores,propiedad);if((typeof(valor)!="undefined"&&valor !=null)&&(typeof(valor.value)!="undefined"&&valor.value !=null)){if(type=="int"){model.update(bean,target,parseInt(valor.value,10));}else if(type=="number"){model.update(bean,target,parseFloat(valor.value));}else{model.update(bean,target,valor.value);}}else{model.update(bean,target,null);}}}return bean;},initValores:function(modelo,item){let campos=modelo.fields;let valor,type=null;modelo.valores={};for(let propiedad in campos){type=campos[propiedad].targetType;if(!type){continue;}valor=campos[propiedad]["default"];if((typeof(valor)==='undefined')||valor===null){valor=model.get(item,propiedad);if(typeof(valor)==='undefined'&&campos[propiedad].target){valor=model.get(item,campos[propiedad].target);}}if((typeof(valor)!=='undefined')&&valor !==null){if(type==='int'){model.update(modelo.valores,propiedad,{value:parseInt(valor,10),label:valor});}else if(type==='number'){model.update(modelo.valores,propiedad,{value:parseFloat(valor),label:valor});}else{model.update(modelo.valores,propiedad,{value:valor,label:valor.toString()});}}else{model.update(modelo.valores,propiedad,{value:null,label:''});}}},obtener_callback:function(configuration,nombre){if(!configuration.callbacks){console.warn("configuration.callbacks is missing");return null;}let callback=configuration.callbacks[nombre];if(!callback){console.warn("required callback is missing: "+nombre);return null;}return callback;}};var validacion={validarCampos:function(nombre,modelo){var formName=nombre+"Form";errores.limpiar(formName,modelo);var fields=modelo.fields;var camposErroneos=0;for(var field in fields){camposErroneos+=validacion.validarCampo(formName,modelo,field);}return(camposErroneos===0);},validarCampo:function(formName,modelo,nombreCampo){errores.hideFieldError(formName,nombreCampo);let valor=model.get(modelo.valores,nombreCampo);let configuracion=modelo.fields[nombreCampo];if(typeof(configuracion)==='undefined'){alert("No se encuentra la configuración para el campo: "+nombreCampo);}let item=this.getItem(configuracion,"notEmpty",valor);let message=null;if(!item.funcion(valor,item.referencia)){let isRequerido=configuracion.required;if(isRequerido){message=this.getMessage(item.template,item.campo,item.referencia,item.valor);errores.showFieldError(formName,nombreCampo,message);return 1;}return 0;}let longitud=configuracion.rules.length;for(var i=0;i <longitud;++i){item=this.getItem(configuracion,configuracion.rules[i],valor);if(!item.funcion(valor,item.referencia)){message=this.getMessage(item.template,item.campo,item.referencia,item.valor);errores.showFieldError(formName,nombreCampo,message);return 1;}}return 0;},getItem:function(configuracion,validacionStr,valorActual){let tokens=validacionStr.split(/\[|\]/);let token=tokens[0].trim();let validation=this.validaciones[token];let item={campo:configuracion.name,funcion:validation.funcion,referencia:null,valor:valorActual,template:validation.template};if(tokens.length >1){token=tokens[1].trim();if(token.length >0){item.referencia=token;}}return item;},validaciones:{notEmpty:{funcion:function(valor){if(!valor){return false;}if(typeof(valor.value)==='undefined'||valor.value===null){return false;}if((typeof(valor.value)!=='undefined'&&valor.value !==null)&&valor.value.length===0){return false;}return true;},template:"Este campo es requerido"},maxLength:{funcion:function(valor,referencia){if(valor){return valor.value.length <=parseInt(referencia,10);}else{return true;}},template:"La longitud del campo '{nombreCampo}' no debe exceder {parametro} caracteres"},minLength:{funcion:function(valor,referencia){if(valor){return valor.value.length >parseInt(referencia,10);}else{return true;}},template:"La longitud del campo '{nombreCampo}' debe ser mayor a {parametro} caracteres"},exactLength:{funcion:function(valor,referencia){if(valor){return(valor.value.length===util.parseInt(referencia));}else{return false;}},template:"La longitud del campo '{nombreCampo}' debe ser {parametro} caracteres"},codigoPostal:{funcion:function(valor){if(!valor.value.match(/^([1-9]{2}|[0-9][1-9]|[1-9][0-9])[0-9]{3}$/gi)){return false;}else{return true;}},template:"Código postal erroneo"},email:{funcion:function(valor){return/^\w+([\.\+\-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,4})+$/.test(valor.value);},template:"No es una dirección de correo valida."},telefono:{funcion:function(valor){return/^([0-9\+\s\+\-])+$/.test(valor.value);},template:"Numero teléfono invalido"},real:{funcion:function(valor){return typeof(valor.value)==="number";},template:"Debe indicar una cantidad numérica"},positive:{funcion:function(valor){return valor.value >=0.00;},template:"Debe indicar una cantidad positiva"},notZero:{funcion:function(valor){return valor.value !==0.00;},template:"Debe indicar una cantidad distinta de cero"},lessEqual:{funcion:function(valor,referencia){return valor.value <=parseFloat(referencia);},template:"El valor debe ser menor o igual a {parametro}"},greatThan:{funcion:function(valor,referencia){return valor.value >parseFloat(referencia);},template:"El valor debe ser mayor a {parametro}"}},getMessage:function(template,campo,referencia,valorActual){var texto=template;texto=texto.replace(/\{nombreCampo\}/g,campo);texto=texto.replace(/\{parametro\}/g,referencia);texto=texto.replace(/\{valorActual\}/g,valorActual);return texto;}};var dom=(function(){function tojQuery(idOrItem){if(typeof(idOrItem)==='undefined'||idOrItem===null){console.error("[ERROR DOM]: id or item is null or undefined");return null;}if(typeof(idOrItem)==='string'){return(idOrItem.startsWith('.')?getByClass(idOrItem):getById(idOrItem));}else{return((idOrItem instanceof jQuery)?idOrItem:jQuery(idOrItem));}}function getById(id){if(typeof(id)==='undefined'||id===null||id.length===0){console.error("[ERROR DOM]: ID is empty, null or undefined");return null;}let item=document.getElementById((id||'').replace(/\./g,'\\.'));if(item===null){console.warn("[WARNING DOM]: Element with ID '"+id+"' was not found");return null;}return jQuery(item);}function getByClass(name){if(typeof(name)==='undefined'||name===null||name.length===0){console.error("[ERROR DOM]: Class name is empty, null or undefined");return null;}let items=jQuery(name);if(items.length===0){console.warn("[WARNING DOM]: Element(s) with class name '"+name+"' were not found");return null;}return items;}function findParentByClass(idOrItem,className){let item=tojQuery(idOrItem);if(item===null){return null;}if(item.hasClass(className)){return item;}let parent=item.parents('.'+className+':eq(0)');return(parent.length===0)?null:parent;}function on(idOrItem,event,data,callback){let item=tojQuery(idOrItem);if(item===null){return null;}if(typeof(callback)==='undefined'||callback===null){return item.on(event,data);}else{return item.on(event,null,data,callback);}}function onClick(idOrItem,data,callback){return on(idOrItem,'click',data,callback);}function append(idOrItem,template,context){let item=tojQuery(idOrItem);if(item===null){return null;}return item.append(templates.fillTemplate(template,context));}function prepend(idOrItem,template,context){let item=tojQuery(idOrItem);if(item===null){return null;}return item.prepend(templates.fillTemplate(template,context));}function after(idOrItem,template,context){let item=tojQuery(idOrItem);if(item===null){return null;}return item.after(templates.fillTemplate(template,context));}function create(idOrItem,template,context){let item=tojQuery(idOrItem);if(item==null){return null;}return item.empty().append(templates.fillTemplate(template,context));}function getText(idOrItem){let item=tojQuery(idOrItem);if(item===null){return null;}return item.val();}function setText(idOrItem,text){let item=tojQuery(idOrItem);if(item===null){return null;}if(item.is('input')){item.val(text);}else{item.text(text);}}function hide(idOrItem){let item=tojQuery(idOrItem);if(item===null){return null;}item.attr('hidden',true);return item;}function show(idOrItem){let item=tojQuery(idOrItem);if(item===null){return null;}item.attr('hidden',false);return item;}return{getById:getById,getByClass:getByClass,findParentByClass:findParentByClass,on:on,onClick:onClick,append:append,prepend:prepend,after:after,create:create,getText:getText,setText:setText,hide:hide,show:show};})();var errores={mostrarErroresRespuesta:function(nombreForm,respuesta){var codigo=respuesta.codigo;var formName=nombreForm+"Form";if(codigo==300||codigo==400){errores.mostrarErrores(formName,respuesta);}else{modalWindow.mostrarErroresRespuesta(respuesta,formName);}},mostrarErrores:function(formName,respuesta){array.each(respuesta.mensajes,function(indice,item){if(item.campo){errores.mostrarMensajeCampo(formName,item);}else{if(item.tipo !="STACK"){errores.mostrarMensajeGeneral(formName,item);}}});},mostrarMensajeGeneral:function(formName,mensajeItem){let tipo=mensajeItem.tipo;if(tipo=="KEY"){let llave=mensajeItem.mensaje;let texto=codigosMensaje[llave];if(typeof(texto)=='undefined'){console.error("No existe el mensaje con la llave: "+llave);}else{errores.showFormError(formName,texto);}}else{let texto=mensajeItem.mensaje;errores.showFormError(formName,texto);}},limpiar:function(formName,modelo){errores.hideFormError(formName);for(var field in modelo.fields){errores.hideFieldError(formName,field);}},showFormError:function(formName,mensaje){let element=jQuery("#"+formName+" .ui.errors > .error");if(element.length >0){element.text(mensaje);jQuery("#"+formName+" .ui.errors").show();}else{modalWindow.mostrarErrorRespuesta(mensaje);}},hideFormError:function(formName){jQuery("#"+formName+" .ui.errors > .error").text("");jQuery("#"+formName+" .ui.errors").hide();},mostrarMensajeCampo:function(formName,mensajeItem){var campo=mensajeItem.campo;var tipo=mensajeItem.tipo;var texto=mensajeItem.mensaje;if(tipo=="KEY"){texto=codigosMensaje[texto];}errores.showFieldError(formName,campo,texto);},hideFieldError:function(formName,nombreCampo){var control=jQuery("#"+formName+" [name='"+nombreCampo+"']");if(control.hasClass("child")){control=control.parent();}control.parents('.form-group').eq(0).removeClass('was-validated');control.siblings('small').remove();},showFieldError:function(formName,nombreCampo,mensaje){var control=jQuery("#"+formName+" [name='"+nombreCampo+"']");if(control.hasClass("child")){control=control.parent();}control.parents('.form-group').eq(0).addClass('was-validated');control.after('<small class="form-text" style="color: #a94442;">'+mensaje+'</small>');},tieneMensaje:function(items,texto){if(!items||items.length===0){return false;}let longitud=items.length;let item=null;for(let i=0;i <longitud;++i){item=items[i];if(item.mensaje==texto){return true;}}return false;}};var perfilPrsp=(function(){let _value=null;function actualizar(callback){server.data.find('presupuesto/usuario/perfil',{idCiclo:app.getIdCiclo()},resp=>{_value=resp.item;console.log('set perfil: '+_value);versionPrsp.update(callback);});}return{update:actualizar,value:function(){return _value;}};})();var versionPrsp=(function(){let _items=null;let _selected=null;function actualizar(callback){let props={idCiclo:app.getIdCiclo()};server.data.list('presupuesto/versionCiclo',{tipo:'NOPAGINADA',propiedades:props},resp=>{_items=resp.items;_selected=array.findByProperty(_items,'activo',true);console.log('set version: '+_selected.version);if(callback){console.log('invoking perfil_version callback');callback();}else{console.log('no callback invoked');}});}function update_selector(onChange_callback){let seccion=dom.getById('selectorVersion');let etiqueta=dom.getById('spnActiveVersion');let selector=dom.getById('selCurrentVersion');dom.show(seccion);dom.hide(etiqueta);dom.hide(selector);let perfil=perfilPrsp.value();if(perfil&&perfil==='ADMIN_PRESUPSTO'){dom.show(selector);selector.empty();for(let item of _items){let mark=(item.activo)?'<b>[*]</b> ':'[_] ';if(_selected&&_selected.id===item.id){selector.append(jQuery("<option/>",{value:JSON.stringify(item),selected:'selected',html:mark+item.version+' ('+item.estatus+' )'}));}else{selector.append(jQuery("<option/>",{value:JSON.stringify(item),html:mark+item.version+' ('+item.estatus+' )'}));}}selector.off('change').on('change',event=>{_selected=JSON.parse(event.target.value);if(onChange_callback){onChange_callback();}});selector.change();}else{dom.show(etiqueta);dom.setText(etiqueta,_selected.version+' ('+_selected.estatus+' )');if(onChange_callback){onChange_callback();}}}function hide_seccion_versiones(){dom.hide('selectorVersion');}return{update:actualizar,updateSelector:update_selector,value:function(){return _selected;},hideSelectorVersiones:hide_seccion_versiones};})();function showError(idElemento,mensaje){dom.getById(idElemento).after('<div class="error-message row"><div class="col-sm-2"></div><div class="col-sm-10"><small class="form-text" style="color: #a94442; padding-left: 15px;">'+mensaje+'</small></div></div>');}function hideErrors(){jQuery(".error-message.row").remove();}var pagina={componentes:{},};'use strict';var ajax=(function(){function login(contexto,bean){return jQuery.ajax({method:"POST",url:contexto+"loginAjax",data:bean,cache:false,dataType:"json"});}function doLogout(contexto){window.location.href=contexto+"logout";}function doRedirect(contexto,trayecto){window.location.href=contexto+trayecto;}function get(contexto,recurso,params){return jQuery.ajax({method:"GET",url:contexto+recurso+((params)?"?"+params:""),cache:false,dataType:"json"});}function post(contexto,recurso,bean,params={}){let paramsTxt='';for(let prop in params){paramsTxt+=((paramsTxt.length===0)?'?':'&')+prop+'='+params[prop];}return jQuery.ajax({method:"POST",url:contexto+recurso+paramsTxt,data:JSON.stringify(bean),cache:false,dataType:"json",contentType:"application/json"});}function json(contexto,recurso){return jQuery.ajax({method:"GET",url:contexto+recurso,cache:true,dataType:"json"});}function load(contexto,idTarget,recurso,callback){let target=dom.getById(idTarget);if(target===null){return;}target.load(contexto+recurso,callback);}function upload(contexto,recurso,archivos,indice,bean){let data=new FormData();bean.nombre=archivos[indice].name;data.append("data",JSON.stringify(bean));data.append(0,archivos[indice]);return jQuery.ajax({url:contexto+recurso,method:'POST',data:data,cache:false,dataType:'json',processData:false,contentType:false});}function download(contexto,recurso,data){return jQuery.ajax({method:'POST',url:contexto+recurso,data:JSON.stringify(data),headers:{"Content-Type":"application/json;charset=UTF-8"},xhrFields:{responseType:'blob'}});}return{login:login,doLogout:doLogout,doRedirect:doRedirect,get:get,post:post,json:json,load:load,upload:upload,download:download};})();
            var server=(function(){
                let q=false;
                let pathname=window.location.pathname;
                let g=pathname.substring(0,pathname.indexOf("/",2));
                let ab=g.length;
                let h=g+"/";
                let i=g+"/_data_/";
                let hAction=g+"/_action_/";
                function p(a,ae,c,b,aa){return function(resolve,reject){resolve(ajax.upload(i,a+"/"+ae,b,aa,c));};}function k(a,ae,c){return function(resolve,reject){resolve(ajax.download(i,a+"/"+ae,c));};}function o(a,ae,c,ad){return function(resolve,reject){resolve(ajax.post(i,a+"/"+ae,c,ad));};}function l(a,ae,ad){return function(resolve,reject){resolve(ajax.get(i,a+"/"+ae,ad));};}function n(c){return function(resolve,reject){resolve(ajax.login(hAction,c));};}function t(){ajax.doLogout(hAction);}function u(trayecto){ajax.doRedirect(h,trayecto);}function v(z,ae,d){ajax.load(h,z,ae+".html",d);};function m(ae){return function(resolve,reject){resolve(ajax.json(h,ae+".json"));};}function x(_d,_r){let d=_d;let r=_r;return function(ag){if(ag.codigo !=200){popup.force_dismiss();if(errores.tieneMensaje(ag.mensajes,"error.sesion.invalida")){q=true;ui.mostrarMensajeSinSesion();setTimeout(t,3000);}else{if(r){errores.mostrarErroresRespuesta(r,ag);}else{modalWindow.mostrarErroresRespuesta(ag);}}return;}popup.end_processing_message();d(ag);};}function ah(ae,c,b,aa){return new Promise(p("upload",ae,c,b,aa));}function xUpload(_d,_r,_ae,_c,_b,_aa){let ae=_ae;let c=_c;let b=_b;let aa=_aa;let d=_d;let r=_r;return function(ag){if(ag.codigo !==200){popup.force_dismiss();if(errores.tieneMensaje(ag.mensajes,"error.sesion.invalida")){q=true;ui.mostrarMensajeSinSesion();setTimeout(t,3000);}else{if(r){errores.mostrarErroresRespuesta(r,ag);}else{modalWindow.mostrarErroresRespuesta(ag);}}return;}popup.end_processing_message();d(ag,aa);if(b.length===(aa+1)){return;}else{return ah(ae,c,b,aa+1);}};}function xDownload(_acArchivo){let ac=_acArchivo;return function(ag){var s=new Blob([ag],{type:'octet/stream'});var sURL=window.URL.createObjectURL(s);var link=document.getElementById('linkDownload');link.href=sURL;link.target='_blank';link.download=ac;link.click();};}function y(ae){return function(error){console.error(error);modalWindow.mostrarErrorInvocacion(error.status,ae);};}return{contexto:h,action:{login:function(c,d,r){new Promise(n(c)).then(x(d,r)).catch(y("loginAjax"));},logout:function(){t();},redirect:function(ai){if(q){return;}u(ai);},save:function(ae,c,d,r){if(q){return;}new Promise(o("save",ae,c)).then(x(d,r)).catch(y(ae));},create:function(ae,c,d,r){if(q){return;}new Promise(o("create",ae,c)).then(x(d,r)).catch(y(ae));},remove:function(ae,c,d){if(q){return;}new Promise(o("delete",ae,c)).then(x(d)).catch(y(ae));},manage:function(ae,a,c,d){if(q){return;}new Promise(o("manage",ae,c,{'action':a})).then(x(d)).catch(y(ae));},upload:function(ae,c,b,d,r){if(q){return;}let af=ah(ae,c,b,0);for(let i=0;i <b.length;++i){af=af.then(xUpload(d,r,ae,c,b,i));}af.catch(y(ae));}},data:{listCatalog:function(ae,f,d){if(q){return;}new Promise(o("catalogo",ae,f||{tipo:"NOPAGINADA"})).then(x(d)).catch(y(ae));},getItemCatalog:function(ae,d){if(q){return;}new Promise(l("catalogo",ae)).then(x(d)).catch(y(ae));},list:function(ae,f,d,r){if(q){return;}new Promise(o("list",ae,f)).then(x(d,r)).catch(y(ae));},get:function(ae,d){if(q){return;}new Promise(l("get",ae)).then(x(d)).catch(y(ae));},find:function(ae,f,d,r){if(q){return;}new Promise(o("getItem",ae,f)).then(x(d,r)).catch(y(ae));},generate:function(ae,item,d,r){if(q){return;}new Promise(o("generate",ae,item)).then(x(d,r)).catch(y(ae));}},resource:{json:function(ae,d){if(q){return;}new Promise(m(ae)).then(d).catch(y(ae));},load:function(z,ae,d){if(q){return;}v(z,ae,d);},download:function(ae,f,acArchivo){if(q){return;}new Promise(k("download",ae,f)).then(xDownload(acArchivo)).catch(y(ae));}}};})();